{
    "resources": {
        "memoryMB": 1024,
        "virtualCores": 1
    },
    "driverResources": {
        "memoryMB": 1024,
        "virtualCores": 1
    },
    "schedule": "0 0 * * *",
    "connections": [
        {
            "from": "Stream",
            "to": "Status Counts"
        },
        {
            "from": "Status Counts",
            "to": "StatusCountFiles"
        },
        {
            "from": "Request Aggregates",
            "to": "RequestAggregateFiles"
        },
        {
            "from": "Stream",
            "to": "Request Aggregates"
        },
        {
            "from": "Stream",
            "to": "Requestor Counts"
        },
        {
            "from": "Requestor Counts",
            "to": "RequestorCountFiles"
        }
    ],
    "stages": [
        {
            "name": "Stream",
            "plugin": {
                "name": "Stream",
                "type": "batchsource",
                "label": "Stream",
                "artifact": {
                    "name": "core-plugins",
                    "version": "1.5.0-SNAPSHOT",
                    "scope": "SYSTEM"
                },
                "properties": {
                    "format": "clf",
                    "name": "accessLogs",
                    "duration": "1d"
                }
            },
            "outputSchema": "{\"name\":\"etlSchemaBody\",\"type\":\"record\",\"fields\":[{\"name\":\"body\",\"type\":\"string\"}]}",
            "type": "batchsource",
            "label": "Stream",
            "icon": "icon-streams",
            "_uiPosition": {
                "top": "331.5px",
                "left": "370.5px"
            },
            "$$hashKey": "object:21963"
        },
        {
            "name": "Status Counts",
            "plugin": {
                "name": "GroupByAggregate",
                "type": "batchaggregator",
                "label": "Status Counts",
                "artifact": {
                    "name": "core-plugins",
                    "version": "1.5.0-SNAPSHOT",
                    "scope": "SYSTEM"
                },
                "properties": {
                    "groupByFields": "status",
                    "aggregates": "numRequests:Count(*)"
                }
            },
            "outputSchema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"status\",\"type\":[\"int\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"}]}",
            "inputSchema": [
                {
                    "name": "Stream",
                    "schema": "{\"name\":\"etlSchemaBody\",\"type\":\"record\",\"fields\":[{\"name\":\"ts\",\"type\":\"long\"},{\"name\":\"headers\",\"type\":{\"type\":\"map\",\"keys\":\"string\",\"values\":\"string\"}},{\"name\":\"remote_host\",\"type\":[\"string\",\"null\"]},{\"name\":\"remote_login\",\"type\":[\"string\",\"null\"]},{\"name\":\"auth_user\",\"type\":[\"string\",\"null\"]},{\"name\":\"request_time\",\"type\":[\"string\",\"null\"]},{\"name\":\"request\",\"type\":[\"string\",\"null\"]},{\"name\":\"status\",\"type\":[\"int\",\"null\"]},{\"name\":\"content_length\",\"type\":[\"int\",\"null\"]},{\"name\":\"referrer\",\"type\":[\"string\",\"null\"]},{\"name\":\"user_agent\",\"type\":[\"string\",\"null\"]}]}"
                }
            ],
            "type": "batchaggregator",
            "label": "Status Counts",
            "icon": "icon-groupbyaggregate",
            "_uiPosition": {
                "top": "141.5px",
                "left": "670.5px"
            },
            "$$hashKey": "object:21964"
        },
        {
            "name": "StatusCountFiles",
            "plugin": {
                "name": "TPFSAvro",
                "type": "batchsink",
                "label": "StatusCountFiles",
                "artifact": {
                    "name": "core-plugins",
                    "version": "1.5.0-SNAPSHOT",
                    "scope": "SYSTEM"
                },
                "properties": {
                    "schema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"status\",\"type\":[\"int\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"}]}",
                    "name": "statusCounts",
                    "cleanPartitionsOlderThan": "60d"
                }
            },
            "outputSchema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"status\",\"type\":[\"int\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"}]}",
            "inputSchema": [
                {
                    "name": "Status Counts",
                    "schema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"status\",\"type\":[\"int\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"}]}"
                }
            ],
            "type": "batchsink",
            "label": "StatusCountFiles",
            "icon": "icon-tpfsavro",
            "_uiPosition": {
                "top": "141.5px",
                "left": "970.5px"
            },
            "$$hashKey": "object:21965"
        },
        {
            "name": "Request Aggregates",
            "plugin": {
                "name": "GroupByAggregate",
                "type": "batchaggregator",
                "label": "Request Aggregates",
                "artifact": {
                    "name": "core-plugins",
                    "version": "1.5.0-SNAPSHOT",
                    "scope": "SYSTEM"
                },
                "properties": {
                    "groupByFields": "request",
                    "aggregates": "numRequests:Count(*),avgResponseLength:Avg(content_length),maxResponseLength:Max(content_length),minResponseLength:Min(content_length)"
                }
            },
            "outputSchema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"request\",\"type\":[\"string\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"},{\"name\":\"avgResponseLength\",\"type\":[\"double\",\"null\"]},{\"name\":\"maxResponseLength\",\"type\":[\"int\",\"null\"]},{\"name\":\"minResponseLength\",\"type\":[\"int\",\"null\"]}]}",
            "inputSchema": [
                {
                    "name": "Null Filter",
                    "schema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"ts\",\"type\":\"long\"},{\"name\":\"headers\",\"type\":{\"type\":\"map\",\"keys\":\"string\",\"values\":\"string\"}},{\"name\":\"remote_host\",\"type\":[\"string\",\"null\"]},{\"name\":\"remote_login\",\"type\":[\"string\",\"null\"]},{\"name\":\"auth_user\",\"type\":[\"string\",\"null\"]},{\"name\":\"request_time\",\"type\":[\"string\",\"null\"]},{\"name\":\"request\",\"type\":[\"string\",\"null\"]},{\"name\":\"status\",\"type\":[\"int\",\"null\"]},{\"name\":\"content_length\",\"type\":[\"int\",\"null\"]},{\"name\":\"referrer\",\"type\":[\"string\",\"null\"]},{\"name\":\"user_agent\",\"type\":[\"string\",\"null\"]}]}"
                }
            ],
            "type": "batchaggregator",
            "label": "Request Aggregates",
            "icon": "icon-groupbyaggregate",
            "_uiPosition": {
                "top": "331.5px",
                "left": "670.5px"
            },
            "$$hashKey": "object:21966"
        },
        {
            "name": "RequestAggregateFiles",
            "plugin": {
                "name": "TPFSAvro",
                "type": "batchsink",
                "label": "RequestAggregateFiles",
                "artifact": {
                    "name": "core-plugins",
                    "version": "1.5.0-SNAPSHOT",
                    "scope": "SYSTEM"
                },
                "properties": {
                    "schema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"request\",\"type\":[\"string\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"},{\"name\":\"avgResponseLength\",\"type\":[\"double\",\"null\"]},{\"name\":\"maxResponseLength\",\"type\":[\"int\",\"null\"]},{\"name\":\"minResponseLength\",\"type\":[\"int\",\"null\"]}]}",
                    "name": "requestAggregates",
                    "cleanPartitionsOlderThan": "60d"
                }
            },
            "outputSchema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"request\",\"type\":[\"string\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"},{\"name\":\"avgResponseLength\",\"type\":[\"double\",\"null\"]},{\"name\":\"maxResponseLength\",\"type\":[\"int\",\"null\"]},{\"name\":\"minResponseLength\",\"type\":[\"int\",\"null\"]}]}",
            "inputSchema": [
                {
                    "name": "Request Aggregates",
                    "schema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"request\",\"type\":[\"string\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"},{\"name\":\"avgResponseLength\",\"type\":[\"double\",\"null\"]},{\"name\":\"maxResponseLength\",\"type\":[\"int\",\"null\"]},{\"name\":\"minResponseLength\",\"type\":[\"int\",\"null\"]}]}"
                }
            ],
            "type": "batchsink",
            "label": "RequestAggregateFiles",
            "icon": "icon-tpfsavro",
            "_uiPosition": {
                "top": "331.5px",
                "left": "970.5px"
            },
            "$$hashKey": "object:21967"
        },
        {
            "name": "Requestor Counts",
            "plugin": {
                "name": "GroupByAggregate",
                "type": "batchaggregator",
                "label": "Requestor Counts",
                "artifact": {
                    "name": "core-plugins",
                    "version": "1.5.0-SNAPSHOT",
                    "scope": "SYSTEM"
                },
                "properties": {
                    "groupByFields": "remote_host",
                    "aggregates": "numRequests:Count(*)"
                }
            },
            "outputSchema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"remote_host\",\"type\":[\"string\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"}]}",
            "inputSchema": [
                {
                    "name": "Stream",
                    "schema": "{\"name\":\"etlSchemaBody\",\"type\":\"record\",\"fields\":[{\"name\":\"ts\",\"type\":\"long\"},{\"name\":\"headers\",\"type\":{\"type\":\"map\",\"keys\":\"string\",\"values\":\"string\"}},{\"name\":\"remote_host\",\"type\":[\"string\",\"null\"]},{\"name\":\"remote_login\",\"type\":[\"string\",\"null\"]},{\"name\":\"auth_user\",\"type\":[\"string\",\"null\"]},{\"name\":\"request_time\",\"type\":[\"string\",\"null\"]},{\"name\":\"request\",\"type\":[\"string\",\"null\"]},{\"name\":\"status\",\"type\":[\"int\",\"null\"]},{\"name\":\"content_length\",\"type\":[\"int\",\"null\"]},{\"name\":\"referrer\",\"type\":[\"string\",\"null\"]},{\"name\":\"user_agent\",\"type\":[\"string\",\"null\"]}]}"
                }
            ],
            "type": "batchaggregator",
            "label": "Requestor Counts",
            "icon": "icon-groupbyaggregate",
            "_uiPosition": {
                "top": "521.5px",
                "left": "670.5px"
            },
            "$$hashKey": "object:21968"
        },
        {
            "name": "RequestorCountFiles",
            "plugin": {
                "name": "TPFSAvro",
                "type": "batchsink",
                "label": "RequestorCountFiles",
                "artifact": {
                    "name": "core-plugins",
                    "version": "1.5.0-SNAPSHOT",
                    "scope": "SYSTEM"
                },
                "properties": {
                    "schema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"remote_host\",\"type\":[\"string\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"}]}",
                    "name": "requestorCounts",
                    "cleanPartitionsOlderThan": "60d"
                }
            },
            "outputSchema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"remote_host\",\"type\":[\"string\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"}]}",
            "inputSchema": [
                {
                    "name": "Requestor Counts",
                    "schema": "{\"type\":\"record\",\"name\":\"etlSchemaBody\",\"fields\":[{\"name\":\"remote_host\",\"type\":[\"string\",\"null\"]},{\"name\":\"numRequests\",\"type\":\"long\"}]}"
                }
            ],
            "type": "batchsink",
            "label": "RequestorCountFiles",
            "icon": "icon-tpfsavro",
            "_uiPosition": {
                "top": "521.5px",
                "left": "970.5px"
            },
            "$$hashKey": "object:21969"
        }
    ]
}
